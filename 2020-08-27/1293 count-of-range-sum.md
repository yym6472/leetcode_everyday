## 介绍

这道题要求的是：给定一个数组，求满足区间和在`[lower, upper]`之间的**所有区间个数**。

## 解法

首先对数组进行一个预处理，处理成前缀和的形式（遇到有关区间和的题目都可以朝这个方向想一想，将区间和变为前缀和之差；同理还有差分预处理）。

然后就会发现，将其如此转化之后，就变成了：求满足`lower <= sums[j] - sums[i] <= upper`且`i < j`的`(i, j)`对数。是不是觉得很像求逆序数对？
因为求逆序数对也可以表示成：求满足`sums[j] - sums[i] < 0`且`i < j`的`(i, j)`对数。

然后就照着[逆序数对的思路](./../2020-08-26/532%20reverse-pairs.md)做就行了，以下是几点不同：
- 在每次的查询时，由一次查询变为了两次查询，因为对于本题而言，上下都有界；而对于逆序数对，则只有上界
- 由于查询时需要对当前的sum值加减lower/upper，因此可能查询的数不在预先处理的数中。这样就导致在做离散化的时候，必须使用TreeSet（方便二分查找）而不能用HashSet